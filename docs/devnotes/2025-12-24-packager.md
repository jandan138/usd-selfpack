# USD Self-Packager Notes (2025-12-24)

## Context
- Target scene: `/shared/smartbot/jiamingda/data_code/simbench/MesaTask-USD/simbench_shared/GRSceneUSD/task9/scene.usd`.
- Goal: self-contain dependencies, convert GLB payloads, and flatten; user prefers binary `.usd` output, not `.usda`.

## Changes
- Scan now classifies reference/payload assets by extension (detects `.glb`/`.gltf`, `.usd`, textures, MDL), enabling GLB payloads to be converted and rewritten.
- Flatten output renamed to `_flatten.usd` (binary extension) instead of `_flatten.usda`.

## GLB handling
- USD cannot open `.glb` payloads directly even if files exist (e.g., `/shared/smartbot/zzh/my_dev/exciting-benchmark/scripts/assets/task9_tea_teapot_livingroom/task9_tea_teapot_livingroom/0.glb`). They must be converted to USD first.
- Now uses Omniverse/Isaac `omni.kit.asset_converter` backend by default (no external binaries). Converted files land in `out_dir/assets_converted_gltf/*.usd` and references/payloads are rewritten to those.
- If the converter extension is unavailable, the run records `convert_fail` in report (copy_fail) with guidance; you can also disable conversion via `--no-convert-gltf`.

## Next steps
- Install or expose `usd_from_gltf` in `PATH` (Isaac/Omniverse typically ships it) and rerun packaging with `--copy-usd-deps --flatten layerstack`.
- If any relative USD references remain unresolved (e.g., `../../models/.../instance.usd`), point the packager at the correct source root or add search paths so `resolve_with_layer` can find them.
